import{A as w,Ba as I,Cb as Y,Da as l,E as p,Ea as u,Fb as W,Ga as B,H as C,I as S,Ia as T,Ja as F,Ka as A,Kb as G,L as x,Lb as J,Mb as K,Oa as b,Pa as U,Qa as y,Sb as Q,Ub as X,W as s,bb as z,ca as $,cb as N,fa as v,fb as V,gb as H,ib as j,ka as d,la as r,ma as o,mb as M,na as f,ob as O,ra as D,sa as g,ta as h,wb as P,xb as L,yb as q}from"./chunk-56PMMHJG.js";var E=class i{http=p(O);baseUrl=P.baseUrl;getServices(e=!1){let t=new M().set("onlyActive",e.toString());return this.http.get(`${this.baseUrl}/services`,{params:t})}addService(e){return this.http.post(`${this.baseUrl}/services`,e)}updateService(e,t){return this.http.put(`${this.baseUrl}/services/${e}`,t)}deleteService(e){return this.http.delete(`${this.baseUrl}/services/${e}`)}toggleServiceStatus(e,t){let n=new M().set("active",t.toString());return this.http.patch(`${this.baseUrl}/services/${e}`,null,{params:n})}saveAttendances(e){return this.http.post(`${this.baseUrl}/attendances`,e)}getAttendances(e,t){let n=new M().set("page",t.toString());return this.http.post(`${this.baseUrl}/attendances/search`,e,{params:n})}invalidateAttendance(e){return this.http.patch(`${this.baseUrl}/attendances/invalidate`,e)}exportAttendances(e){return this.http.post(`${this.baseUrl}/attendances/export`,e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};var k=class i{http=p(O);baseUrl=`${P.baseUrl}/services-events`;findAll(e){return this.http.post(`${this.baseUrl}/calendar`,e)}getActiveEvent(){return this.http.get(`${this.baseUrl}/active`)}create(e){return this.http.post(this.baseUrl,e)}cancelEvent(e){return this.http.delete(`${this.baseUrl}/${e}`)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=w({token:i,factory:i.\u0275fac,providedIn:"root"})};function te(i,e){if(i&1&&(r(0,"option",24),l(1),o()),i&2){let t=e.$implicit;d("value",t.id),s(),u(t.name)}}function ne(i,e){if(i&1&&(r(0,"option",24),l(1),o()),i&2){let t=e.$implicit;d("value",t.id),s(),u(t.name)}}function ie(i,e){if(i&1){let t=D();r(0,"div",25)(1,"div",11),f(2,"i",26),r(3,"select",13),A("ngModelChange",function(a){C(t);let c=h();return F(c.selectedBranchId,a)||(c.selectedBranchId=a),S(a)}),g("change",function(){C(t);let a=h();return S(a.onFilterChange())}),r(4,"option",14),l(5,"Todas las sedes"),o(),v(6,ne,2,2,"option",15),o()()()}if(i&2){let t=h();s(3),T("ngModel",t.selectedBranchId),s(3),d("ngForOf",t.branches)}}function re(i,e){if(i&1){let t=D();r(0,"button",27),g("click",function(){C(t);let a=h();return S(a.onCreateClick())}),f(1,"i",28),r(2,"span",29),l(3,"Nuevo Evento"),o()()}}function ae(i,e){if(i&1&&(r(0,"div",30),l(1),o()),i&2){let t=e.$implicit;s(),u(t)}}function oe(i,e){if(i&1&&(r(0,"span",40),l(1),o()),i&2){let t=h().$implicit;s(),u(t.branchName)}}function se(i,e){if(i&1){let t=D();r(0,"div",36),b(1,"date"),b(2,"date"),g("click",function(a){let c=C(t).$implicit,m=h(2);return S(m.onEventClick(c,a))}),r(3,"span",37),l(4),b(5,"date"),b(6,"date"),o(),r(7,"span",38),l(8),o(),v(9,oe,2,1,"span",39),o()}if(i&2){let t=e.$implicit,n=h(2);I("clickable",!n.isSelectionMode||!n.isFutureEvent(t))("disabled-event",n.isSelectionMode&&n.isFutureEvent(t)),d("title",t.serviceName+" ("+y(1,9,t.startDateTime,"HH:mm")+" - "+y(2,12,t.endDateTime,"HH:mm")+`) 
`+(t.address||t.branchName)),s(4),B(" ",y(5,15,t.startDateTime,"HH:mm")," - ",y(6,18,t.endDateTime,"HH:mm")," "),s(4),u(t.serviceName),s(),d("ngIf",n.isAdmin&&!n.selectedBranchId)}}function ce(i,e){if(i&1){let t=D();r(0,"div",31),g("click",function(){let a=C(t).$implicit,c=h();return S(c.onDayClick(a))}),r(1,"div",32)(2,"span",33),l(3),b(4,"date"),o()(),r(5,"div",34),v(6,se,10,21,"div",35),o()()}if(i&2){let t=e.$implicit;I("not-current-month",!t.isCurrentMonth)("today",t.isToday),s(3),u(y(4,6,t.date,"d")),s(3),d("ngForOf",t.events)}}function le(i,e){i&1&&(r(0,"div",41),f(1,"div",42),r(2,"p"),l(3,"Cargando eventos..."),o()())}var ee=class i{eventService=p(k);asistenciaService=p(E);branchService=p(X);notificationService=p(q);authService=p(L);isAdmin=!1;isSelectionMode=!1;canCreate=!1;eventSelected=new x;eventAction=new x;createEvent=new x;daySelected=new x;currentDate=new Date;calendarDays=[];weekDays=["Dom","Lun","Mar","Mi\xE9","Jue","Vie","S\xE1b"];selectedBranchId="";selectedServiceId="";events=[];services=[];branches=[];isLoading=!0;ngOnInit(){if(this.generateCalendar(),this.loadServices(),this.isAdmin&&this.loadBranches(),!this.isAdmin){let e=this.authService.currentUser();this.selectedBranchId=e?.branchId||e?.memberResponseDto?.branch?.id||""}}get currentMonthLabel(){return this.currentDate.toLocaleDateString("es-ES",{month:"long",year:"numeric"})}prevMonth(){this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()-1,1),this.generateCalendar()}nextMonth(){this.currentDate=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+1,1),this.generateCalendar()}goToToday(){this.currentDate=new Date,this.generateCalendar()}generateCalendar(){let e=this.currentDate.getFullYear(),t=this.currentDate.getMonth(),n=new Date(e,t,1),a=new Date(e,t+1,0),c=new Date(n);c.setDate(c.getDate()-c.getDay()),c.setHours(0,0,0,0);let m=new Date(a);m.getDay()<6&&m.setDate(m.getDate()+(6-m.getDay())),m.setHours(23,59,59,999);let R=[],_=new Date(c);for(;_<=m;)R.push({date:new Date(_),isCurrentMonth:_.getMonth()===t,isToday:this.isSameDate(_,new Date),events:[]}),_.setDate(_.getDate()+1);this.calendarDays=R,this.loadEvents(c,m)}isSameDate(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}onFilterChange(){this.generateCalendar()}refresh(){this.generateCalendar()}loadEvents(e,t){this.isLoading=!0;let n={startDate:e.toISOString(),endDate:t.toISOString(),branchId:this.selectedBranchId||void 0,serviceId:this.selectedServiceId||void 0};this.eventService.findAll(n).subscribe({next:a=>{this.events=a||[],this.mapEventsToDays(),this.isLoading=!1},error:a=>{console.error("Error loading events",a),this.isLoading=!1,this.notificationService.error("Error al cargar los eventos")}})}mapEventsToDays(){this.calendarDays.forEach(e=>e.events=[]),this.events.forEach(e=>{let t=new Date(e.startDateTime),n=this.calendarDays.find(a=>this.isSameDate(a.date,t));n&&n.events.push(e)}),this.calendarDays.forEach(e=>{e.events.sort((t,n)=>new Date(t.startDateTime).getTime()-new Date(n.startDateTime).getTime())})}loadServices(){this.asistenciaService.getServices(!0).subscribe(e=>this.services=e)}loadBranches(){this.branchService.findAll().subscribe(e=>this.branches=e)}isFutureEvent(e){return new Date(e.startDateTime)>new Date}onEventClick(e,t){t.stopPropagation(),!(this.isSelectionMode&&this.isFutureEvent(e))&&(this.isSelectionMode?this.eventSelected.emit(e):this.eventAction.emit(e))}onCreateClick(){this.createEvent.emit()}onDayClick(e){if(!this.isSelectionMode&&this.canCreate){let t=e.date.getFullYear(),n=String(e.date.getMonth()+1).padStart(2,"0"),a=String(e.date.getDate()).padStart(2,"0");this.daySelected.emit(`${t}-${n}-${a}`)}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=$({type:i,selectors:[["app-service-calendar"]],inputs:{isAdmin:"isAdmin",isSelectionMode:"isSelectionMode",canCreate:"canCreate"},outputs:{eventSelected:"eventSelected",eventAction:"eventAction",createEvent:"createEvent",daySelected:"daySelected"},decls:29,vars:10,consts:[[1,"calendar-container","fade-in"],[1,"calendar-header"],[1,"header-left"],[1,"calendar-nav"],[1,"nav-btn",3,"click"],[1,"fa-solid","fa-chevron-left"],[1,"month-label"],[1,"fa-solid","fa-chevron-right"],[1,"nav-btn","today-btn",3,"click"],[1,"header-actions"],[1,"soft-input-group","service-filter-group"],[1,"soft-input-wrapper"],[1,"fa-solid","fa-church","soft-input-icon"],[1,"soft-input",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","soft-input-group branch-filter-group",4,"ngIf"],["class","btn btn-primary btn-new-event",3,"click",4,"ngIf"],[1,"calendar-wrapper"],[1,"calendar-grid-header"],["class","weekday-cell",4,"ngFor","ngForOf"],[1,"calendar-grid-body"],["class","day-cell","style","cursor: pointer;",3,"not-current-month","today","click",4,"ngFor","ngForOf"],["class","loading-overlay",4,"ngIf"],[3,"value"],[1,"soft-input-group","branch-filter-group"],[1,"fa-solid","fa-building","soft-input-icon"],[1,"btn","btn-primary","btn-new-event",3,"click"],[1,"fa-solid","fa-plus"],[1,"desktop-only"],[1,"weekday-cell"],[1,"day-cell",2,"cursor","pointer",3,"click"],[1,"day-header"],[1,"day-number"],[1,"day-events"],["class","event-pill",3,"title","clickable","disabled-event","click",4,"ngFor","ngForOf"],[1,"event-pill",3,"click","title"],[1,"event-time"],[1,"event-title"],["class","event-branch",4,"ngIf"],[1,"event-branch"],[1,"loading-overlay"],[1,"spinner"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),g("click",function(){return n.prevMonth()}),f(5,"i",5),o(),r(6,"h1",6),l(7),b(8,"titlecase"),o(),r(9,"button",4),g("click",function(){return n.nextMonth()}),f(10,"i",7),o(),r(11,"button",8),g("click",function(){return n.goToToday()}),l(12,"Hoy"),o()()(),r(13,"div",9)(14,"div",10)(15,"div",11),f(16,"i",12),r(17,"select",13),A("ngModelChange",function(c){return F(n.selectedServiceId,c)||(n.selectedServiceId=c),c}),g("change",function(){return n.onFilterChange()}),r(18,"option",14),l(19,"Todos los servicios"),o(),v(20,te,2,2,"option",15),o()()(),v(21,ie,7,2,"div",16)(22,re,4,0,"button",17),o()(),r(23,"div",18)(24,"div",19),v(25,ae,2,1,"div",20),o(),r(26,"div",21),v(27,ce,7,9,"div",22),o(),v(28,le,4,0,"div",23),o()()),t&2&&(s(7),u(U(8,8,n.currentMonthLabel)),s(10),T("ngModel",n.selectedServiceId),s(3),d("ngForOf",n.services),s(),d("ngIf",n.isAdmin),s(),d("ngIf",!n.isSelectionMode&&n.canCreate),s(3),d("ngForOf",n.weekDays),s(2),d("ngForOf",n.calendarDays),s(),d("ngIf",n.isLoading))},dependencies:[j,z,N,Q,J,K,G,Y,W,V,H],styles:['[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.calendar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;gap:1rem;padding:1rem;background:var(--bg-main);box-shadow:var(--shadow-sm);border-radius:12px}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:.5rem;flex-wrap:wrap;gap:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem}.calendar-nav[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;background:var(--bg-card);padding:.25rem;border-radius:12px;border:1px solid var(--border-color);box-shadow:var(--shadow-sm)}.nav-btn[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:none;background:transparent;border-radius:8px;cursor:pointer;color:var(--text-muted);transition:all .2s}.nav-btn[_ngcontent-%COMP%]:hover{background:var(--bg-input);color:var(--primary)}.today-btn[_ngcontent-%COMP%]{width:auto;padding:0 .75rem;font-size:.85rem;font-weight:600}.month-label[_ngcontent-%COMP%]{min-width:150px;text-align:center;font-size:1.1rem;font-weight:700;color:var(--text-main);margin:0;text-transform:capitalize}.header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.soft-input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.soft-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.soft-input-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;color:var(--text-muted);font-size:.9rem;z-index:10}.soft-input[_ngcontent-%COMP%]{width:100%;padding:.6rem 2.5rem;background:var(--bg-input);border:1px solid transparent;border-radius:12px;font-size:.9rem;color:var(--text-main);transition:all .2s ease;cursor:pointer;font-weight:500;min-width:200px}.soft-input[_ngcontent-%COMP%]:hover, .soft-input[_ngcontent-%COMP%]:focus{background:var(--bg-card);border-color:var(--border-color);box-shadow:var(--shadow-sm)}.calendar-wrapper[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:var(--bg-card);border-radius:16px;border:1px solid var(--border-color);box-shadow:var(--shadow-sm);overflow:hidden;min-height:0}.calendar-grid-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid var(--border-color);background:var(--bg-input)}.weekday-cell[_ngcontent-%COMP%]{padding:.75rem;text-align:center;font-size:.85rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}.calendar-grid-body[_ngcontent-%COMP%]{flex:1;display:grid;grid-template-columns:repeat(7,1fr);grid-template-rows:repeat(auto-fill,minmax(100px,1fr));overflow-y:auto}.day-cell[_ngcontent-%COMP%]{border-right:1px solid var(--border-color);border-bottom:1px solid var(--border-color);padding:.5rem;display:flex;flex-direction:column;gap:.5rem;min-height:120px;background:var(--bg-card);transition:background .2s}.day-cell[_ngcontent-%COMP%]:nth-child(7n){border-right:none}.day-cell.not-current-month[_ngcontent-%COMP%]{background:var(--bg-main);opacity:.6}.day-cell.today[_ngcontent-%COMP%]{background:#2563eb0d}.day-cell.today[_ngcontent-%COMP%]   .day-number[_ngcontent-%COMP%]{background:var(--primary);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center}.day-header[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.day-number[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--text-main);padding:2px}.day-events[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;overflow-y:auto}.event-pill[_ngcontent-%COMP%]{background:#6366f11a;border-left:3px solid #6366f1;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;color:var(--text-main);cursor:pointer;transition:all .2s;display:flex;flex-direction:column;line-height:1.2}.event-pill.clickable[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 6px -1px #0000001a;filter:brightness(.95)}.event-pill.disabled-event[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed;background:#e2e8f0;color:#94a3b8;pointer-events:none;box-shadow:none}[data-theme="dark"][_nghost-%COMP%]   .event-pill.disabled-event[_ngcontent-%COMP%], [data-theme="dark"]   [_nghost-%COMP%]   .event-pill.disabled-event[_ngcontent-%COMP%]{background:#334155;color:#64748b}.event-time[_ngcontent-%COMP%]{font-weight:700;font-size:.7rem;color:#6366f1}.event-title[_ngcontent-%COMP%]{font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.event-branch[_ngcontent-%COMP%]{font-size:.65rem;color:var(--text-muted)}.loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#fffc;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid var(--primary);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media(max-width:768px){.calendar-container[_ngcontent-%COMP%]{padding:.5rem}.calendar-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:.75rem}.header-left[_ngcontent-%COMP%]{justify-content:space-between;width:100%;margin-bottom:.25rem}.header-actions[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.75rem}.service-filter-group[_ngcontent-%COMP%]{width:100%}.service-filter-group[_ngcontent-%COMP%]   .soft-input[_ngcontent-%COMP%]{width:100%;padding:.6rem .6rem .6rem 2.5rem!important}.branch-filter-group[_ngcontent-%COMP%]{width:100%!important;min-width:100%!important}.branch-filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%!important}.btn-new-event[_ngcontent-%COMP%]{width:100%!important;justify-content:center!important;padding:.6rem!important;height:auto!important}.btn-new-event[_ngcontent-%COMP%]   .desktop-only[_ngcontent-%COMP%]{display:inline-block!important;margin-left:.5rem}.month-label[_ngcontent-%COMP%]{min-width:auto;font-size:1rem;flex:1}.calendar-wrapper[_ngcontent-%COMP%]{border-radius:12px}.weekday-cell[_ngcontent-%COMP%]{padding:.5rem .25rem;font-size:.7rem}.day-cell[_ngcontent-%COMP%]{min-height:80px;padding:.25rem}.day-number[_ngcontent-%COMP%]{font-size:.8rem}.event-pill[_ngcontent-%COMP%]{padding:.15rem .25rem;border-left-width:2px}.event-time[_ngcontent-%COMP%], .event-title[_ngcontent-%COMP%]{font-size:.65rem}.desktop-only[_ngcontent-%COMP%]{display:none}}']})};export{E as a,k as b,ee as c};
