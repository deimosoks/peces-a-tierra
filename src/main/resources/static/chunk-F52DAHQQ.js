import{a as L}from"./chunk-MPP7YJHR.js";import{Ab as T,Bb as x,Cb as V,Da as s,Db as N,E as _,Ea as h,Fa as M,Gb as B,H as p,I as f,Ib as A,Jb as D,M as C,Pb as F,Rb as q,Tb as z,Ub as G,Vb as R,W as a,ab as w,bb as P,ca as S,cb as O,fa as u,ib as E,ka as d,la as n,ma as r,na as m,ra as v,sa as g,ta as l,xb as k,yb as I}from"./chunk-56PMMHJG.js";import{e as y}from"./chunk-FDERIQAA.js";function $(i,t){if(i&1){let e=v();n(0,"button",9),g("click",function(){p(e);let c=l();return f(c.openModal())}),m(1,"i",10),s(2," Nueva Sede "),r()}}function U(i,t){i&1&&(n(0,"div",11),m(1,"div",12),n(2,"div"),s(3,"Cargando sedes..."),r()())}function H(i,t){if(i&1){let e=v();n(0,"button",9),g("click",function(){p(e);let c=l(2);return f(c.openModal())}),m(1,"i",10),s(2," Crear Primera Sede "),r()}}function Y(i,t){if(i&1&&(n(0,"div",13)(1,"div",14),m(2,"i",15),r(),n(3,"h3"),s(4,"No hay sedes registradas"),r(),n(5,"p"),s(6,"Comienza creando una nueva sede para gestionar las ubicaciones."),r(),u(7,H,3,0,"button",4),r()),i&2){let e=l();a(7),d("ngIf",e.canCreate)}}function Z(i,t){if(i&1){let e=v();n(0,"button",27),g("click",function(){p(e);let c=l().$implicit,b=l(2);return f(b.openModal(c))}),m(1,"i",28),r()}}function J(i,t){if(i&1){let e=v();n(0,"button",29),g("click",function(){p(e);let c=l().$implicit,b=l(2);return f(b.deleteBranch(c))}),m(1,"i",30),r()}}function K(i,t){if(i&1&&(n(0,"div",31),m(1,"i",32),n(2,"span"),s(3),r()()),i&2){let e=l().$implicit;a(3),h(e.address)}}function Q(i,t){if(i&1&&(n(0,"div",31),m(1,"i",33),n(2,"span"),s(3),r()()),i&2){let e=l().$implicit;a(3),h(e.city)}}function W(i,t){if(i&1&&(n(0,"div",31),m(1,"i",34),n(2,"span"),s(3),r()()),i&2){let e=l().$implicit;a(3),h(e.cellphone)}}function X(i,t){if(i&1&&(n(0,"div",18)(1,"div",19)(2,"div")(3,"h3",20),s(4),r()(),n(5,"div",21),u(6,Z,2,0,"button",22)(7,J,2,0,"button",23),r()(),n(8,"div",24)(9,"div",25),u(10,K,4,1,"div",26)(11,Q,4,1,"div",26)(12,W,4,1,"div",26),r()()()),i&2){let e=t.$implicit,o=l(2);a(4),h(e.name),a(2),d("ngIf",o.canUpdate),a(),d("ngIf",o.canDelete),a(3),d("ngIf",e.address),a(),d("ngIf",e.city),a(),d("ngIf",e.cellphone)}}function ee(i,t){if(i&1&&(n(0,"div",16),u(1,X,13,6,"div",17),r()),i&2){let e=l();a(),d("ngForOf",e.branches)}}function te(i,t){i&1&&(n(0,"div",59)(1,"div",60),m(2,"div",61),n(3,"p"),s(4,"Procesando..."),r()()())}function ne(i,t){if(i&1){let e=v();n(0,"div",35),g("click",function(){p(e);let c=l();return f(c.closeModal())}),n(1,"div",36),g("click",function(c){return p(e),f(c.stopPropagation())}),n(2,"div",37)(3,"h2"),s(4),r(),n(5,"button",38),g("click",function(){p(e);let c=l();return f(c.closeModal())}),s(6,"\xD7"),r()(),u(7,te,5,0,"div",39),n(8,"div",40)(9,"form",41),g("submit",function(){p(e);let c=l();return f(c.save())}),n(10,"div",42)(11,"div",43)(12,"label",44),s(13,"Nombre de la Sede"),r(),n(14,"div",45),m(15,"i",46)(16,"input",47),r()(),n(17,"div",43)(18,"label",44),s(19,"Direcci\xF3n"),r(),n(20,"div",45),m(21,"i",48)(22,"input",49),r()(),n(23,"div",50)(24,"label",44),s(25,"Ciudad"),r(),n(26,"div",45),m(27,"i",51)(28,"input",52),r()(),n(29,"div",50)(30,"label",44),s(31,"Celular"),r(),n(32,"div",45),m(33,"i",53)(34,"input",54),r()()(),n(35,"div",55)(36,"button",56),g("click",function(){p(e);let c=l();return f(c.closeModal())}),s(37," Cancelar "),r(),n(38,"button",57),m(39,"i",58),s(40),r()()()()()()}if(i&2){let e=l();a(4),h(e.isEditing?"Editar Sede":"Nueva Sede"),a(),d("disabled",e.isSaving),a(2),d("ngIf",e.isSaving),a(2),d("formGroup",e.form),a(27),d("disabled",e.isSaving),a(2),d("disabled",e.form.invalid||e.isSaving),a(),d("ngClass",e.isSaving?"fa-spinner fa-spin":"fa-save"),a(),M(" ",e.isSaving?"Guardando...":"Guardar"," ")}}var j=class i{fb=_(q);branchService=_(G);notificationService=_(I);confirmationService=_(R);roleService=_(L);authService=_(k);ngZone=_(C);branches=[];isLoading=!0;isSaving=!1;showModal=!1;isEditing=!1;currentBranchId=null;canCreate=!1;canUpdate=!1;canDelete=!1;form;constructor(){this.form=this.fb.group({name:["",x.required],address:["",x.required],city:["",x.required],cellphone:["",x.required]})}ngOnInit(){this.checkPermissions(),this.loadBranches()}checkPermissions(){this.canCreate=this.authService.can("BRANCH_CREATE"),this.canUpdate=this.authService.can("BRANCH_UPDATE"),this.canDelete=this.authService.can("BRANCH_DELETE")}loadBranches(){this.isLoading=!0,this.branchService.findAll().subscribe({next:t=>{this.branches=t,this.isLoading=!1},error:t=>{console.error("Error loading branches",t),this.isLoading=!1,this.notificationService.error("Error al cargar las sedes")}})}openModal(t){this.isEditing=!!t,this.currentBranchId=t?.id||null,t?this.form.patchValue({name:t.name,address:t.address,city:t.city,cellphone:t.cellphone}):this.form.reset({name:"",address:"",city:"",cellphone:""}),this.showModal=!0,setTimeout(()=>this.initGoogleAutocomplete(),100)}closeModal(){this.showModal=!1,this.form.reset(),this.isSaving=!1}save(){if(this.form.invalid||this.isSaving)return;this.isSaving=!0;let t=this.form.value;(this.isEditing&&this.currentBranchId?this.branchService.update(this.currentBranchId,t):this.branchService.create(t)).subscribe({next:()=>{this.notificationService.success(this.isEditing?"Sede actualizada correctamente":"Sede creada correctamente"),this.loadBranches(),this.closeModal()},error:o=>{console.error("Error saving branch",o),this.notificationService.error("Error al guardar la sede"),this.isSaving=!1}})}deleteBranch(t){return y(this,null,function*(){(yield this.confirmationService.confirm({title:"Eliminar Sede",message:`\xBFEst\xE1s seguro de eliminar la sede "${t.name}"? Esta acci\xF3n no se puede deshacer.`,type:"danger",confirmText:"Eliminar"}))&&this.branchService.delete(t.id).subscribe({next:()=>{this.notificationService.success("Sede eliminada correctamente"),this.loadBranches()},error:o=>{console.error("Error deleting branch",o),this.notificationService.error("Error al eliminar la sede")}})})}initGoogleAutocomplete(){let t=document.getElementById("googleAddress");if(!t)return;if(typeof google>"u"){console.error("Google Maps API not loaded");return}let e=new google.maps.places.Autocomplete(t,{componentRestrictions:{country:"co"},fields:["address_components","geometry","formatted_address"],types:["geocode","establishment"]});e.addListener("place_changed",()=>{this.ngZone.run(()=>{let o=e.getPlace();this.handleGoogleResult(o)})})}handleGoogleResult(t){if(!t.geometry)return;let e=t.address_components,o="";for(let c of e)if(c.types.includes("locality")){o=c.long_name;break}this.form.patchValue({address:t.formatted_address,city:o||this.form.get("city")?.value})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-sedes"]],decls:11,vars:5,consts:[[1,"fade-in"],[1,"page-header"],[1,"page-title"],[1,"header-actions"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","grid-container",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-plus"],[1,"loading-container"],[1,"loading-spinner"],[1,"empty-state"],[1,"empty-icon"],[1,"fa-solid","fa-map-location-dot"],[1,"grid-container"],["class","card branch-card",4,"ngFor","ngForOf"],[1,"card","branch-card"],[1,"card-header","branch-header"],[1,"branch-name"],[1,"branch-actions"],["class","icon-btn","title","Editar",3,"click",4,"ngIf"],["class","icon-btn danger","title","Eliminar",3,"click",4,"ngIf"],[1,"card-body"],[1,"branch-info"],["class","info-item",4,"ngIf"],["title","Editar",1,"icon-btn",3,"click"],[1,"fa-solid","fa-pen"],["title","Eliminar",1,"icon-btn","danger",3,"click"],[1,"fa-solid","fa-trash"],[1,"info-item"],[1,"fa-solid","fa-location-dot"],[1,"fa-solid","fa-city"],[1,"fa-solid","fa-phone"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click","disabled"],["class","modal-loading-overlay",4,"ngIf"],[1,"modal-body"],[3,"submit","formGroup"],[1,"form-grid"],[1,"soft-input-group","full-width"],[1,"soft-label"],[1,"soft-input-wrapper"],[1,"fa-solid","fa-building","soft-input-icon"],["type","text","formControlName","name","placeholder","Ej: Sede Central, Norte...","required","",1,"soft-input"],[1,"fa-solid","fa-map-pin","soft-input-icon"],["type","text","id","googleAddress","formControlName","address","placeholder","Direcci\xF3n completa","required","",1,"soft-input"],[1,"soft-input-group"],[1,"fa-solid","fa-city","soft-input-icon"],["type","text","formControlName","city","placeholder","Ciudad","required","",1,"soft-input"],[1,"fa-solid","fa-phone","soft-input-icon"],["type","tel","formControlName","cellphone","placeholder","N\xFAmero de celular","required","",1,"soft-input"],[1,"modal-footer"],["type","button",1,"btn","btn-muted",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"fa-solid",3,"ngClass"],[1,"modal-loading-overlay"],[1,"spinner-wrapper"],[1,"spinner-circle"]],template:function(e,o){e&1&&(n(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),s(4,"Sedes"),r()(),n(5,"div",3),u(6,$,3,0,"button",4),r()(),u(7,U,4,0,"div",5)(8,Y,8,1,"div",6)(9,ee,2,1,"div",7),r(),u(10,ne,41,8,"div",8)),e&2&&(a(6),d("ngIf",o.canCreate),a(),d("ngIf",o.isLoading),a(),d("ngIf",!o.isLoading&&o.branches.length===0),a(),d("ngIf",!o.isLoading&&o.branches.length>0),a(),d("ngIf",o.showModal))},dependencies:[E,w,P,O,z,B,T,V,N,F,D,A],styles:['.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem}.page-title[_ngcontent-%COMP%]{font-size:1.75rem;font-weight:700;color:var(--text-primary);margin:0}.text-muted[_ngcontent-%COMP%]{color:var(--text-secondary);margin:.5rem 0 0}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}.branch-card[_ngcontent-%COMP%]{border-radius:12px;transition:transform .2s,box-shadow .2s;overflow:hidden}.branch-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f}.branch-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;padding:1.25rem;border-bottom:1px solid var(--border-color);background:var(--bg-secondary)}.branch-name[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary)}.branch-meta[_ngcontent-%COMP%]{margin-top:.5rem}.branch-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.icon-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;border:none;background:transparent;color:var(--text-secondary);cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}.icon-btn[_ngcontent-%COMP%]:hover{background:var(--bg-hover);color:var(--primary-color)}.icon-btn.danger[_ngcontent-%COMP%]:hover{background:#fee2e2;color:#ef4444}.branch-info[_ngcontent-%COMP%]{padding:1.25rem;display:flex;flex-direction:column;gap:.75rem}.info-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;color:var(--text-secondary);font-size:.9rem}.info-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{width:16px;color:var(--text-tertiary)}.toggle-check[_ngcontent-%COMP%]{margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid var(--border-color);display:flex;align-items:center;gap:1rem}.check-label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary)}.badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:9999px;font-size:.75rem;font-weight:500}.badge-success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.badge-secondary[_ngcontent-%COMP%]{background:#f3f4f6;color:#4b5563}.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);animation:_ngcontent-%COMP%_fadeIn .2s}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}.modal-content[_ngcontent-%COMP%]{background:var(--bg-card);border-radius:16px;width:90%;max-width:500px;max-height:90vh;overflow:hidden;box-shadow:var(--shadow-md);animation:_ngcontent-%COMP%_slideUp .3s;display:flex;flex-direction:column}@keyframes _ngcontent-%COMP%_slideUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.modal-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid var(--border-color);display:flex;align-items:center;justify-content:space-between;background:var(--bg-input);flex-shrink:0}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700;color:var(--text-primary)}.close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.75rem;color:var(--text-secondary);cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:all .2s}.close-btn[_ngcontent-%COMP%]:hover{background:var(--border-color);color:var(--text-primary)}.modal-body[_ngcontent-%COMP%]{padding:1.5rem;overflow-y:auto;flex:1}.modal-footer[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}@media(max-width:640px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.modal-content[_ngcontent-%COMP%]{width:95%;max-height:95vh}}.soft-input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.soft-label[_ngcontent-%COMP%]{font-size:.85rem;font-weight:600;color:var(--text-secondary);margin-left:.25rem}.soft-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.soft-input-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;color:var(--text-tertiary);font-size:1rem;pointer-events:none;z-index:10}.soft-input[_ngcontent-%COMP%]{width:100%;padding:.75rem 1rem .75rem 2.75rem;background:var(--bg-input);border:1px solid transparent;border-radius:12px;font-size:.95rem;color:var(--text-primary);transition:all .2s ease;box-shadow:inset 2px 2px 5px #00000008,inset -2px -2px 5px #ffffff80}.soft-input[_ngcontent-%COMP%]:focus{outline:none;background:var(--bg-card);box-shadow:0 0 0 3px rgba(var(--primary-rgb),.15),inset 1px 1px 2px #0000000d}.soft-input[_ngcontent-%COMP%]::placeholder{color:var(--text-muted)}.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;width:44px;height:24px}.switch[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background-color:#cbd5e1;transition:.4s}.slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:#fff;transition:.4s}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:var(--primary)}input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(20px)}.slider.round[_ngcontent-%COMP%]{border-radius:34px}.slider.round[_ngcontent-%COMP%]:before{border-radius:50%}']})};export{j as Sedes};
