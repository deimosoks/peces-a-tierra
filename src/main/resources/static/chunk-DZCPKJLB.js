import{a as L,b as Y,c as C}from"./chunk-W2JH4KPR.js";import{Ab as z,Bb as u,Cb as N,Da as d,Db as V,E as s,Ea as x,Gb as F,H as h,I as b,Ib as D,Jb as B,Kb as j,Lb as G,Mb as R,Rb as U,Sb as $,Tb as q,Ub as Q,Vb as H,W as c,bb as E,ca as M,cb as k,fa as g,ib as I,ja as S,ka as l,la as r,ma as n,na as m,ra as _,sa as v,ta as p,ua as w,va as O,wa as P,xb as T,yb as A}from"./chunk-56PMMHJG.js";import{e as y}from"./chunk-FDERIQAA.js";function K(i,t){if(i&1){let e=_();r(0,"div",4),v("click",function(){h(e);let a=p();return b(a.closeModal())}),n()}}function W(i,t){i&1&&(r(0,"div",5)(1,"div",6),m(2,"div",7),r(3,"p"),d(4,"Guardando evento..."),n()()())}function X(i,t){if(i&1&&(r(0,"option",28),d(1),n()),i&2){let e=t.$implicit;l("value",e.id),c(),x(e.name)}}function Z(i,t){if(i&1&&(r(0,"option",28),d(1),n()),i&2){let e=t.$implicit;l("value",e.id),c(),x(e.name)}}function ee(i,t){if(i&1&&(r(0,"div",14)(1,"label",15),d(2,"Sede"),n(),r(3,"select",29)(4,"option",17),d(5,"Seleccione una sede"),n(),g(6,Z,2,2,"option",18),n()()),i&2){let e=p(2);c(3),S("disabled",e.isAdmin?null:""),c(3),l("ngForOf",e.branches)}}function te(i,t){i&1&&(r(0,"span"),d(1,"Guardar"),n())}function ne(i,t){i&1&&(r(0,"span"),m(1,"i",30),d(2," Guardando..."),n())}function ie(i,t){if(i&1){let e=_();r(0,"div",8)(1,"div",9)(2,"h2",10),d(3,"Nuevo Evento"),n(),r(4,"button",11),v("click",function(){h(e);let a=p();return b(a.closeModal())}),m(5,"i",12),n()(),r(6,"form",13),v("ngSubmit",function(){h(e);let a=p();return b(a.save())}),r(7,"div",14)(8,"label",15),d(9,"Servicio"),n(),r(10,"select",16)(11,"option",17),d(12,"Seleccione un servicio"),n(),g(13,X,2,2,"option",18),n()(),g(14,ee,7,2,"div",19),r(15,"div",14)(16,"label",15),d(17,"Fecha"),n(),m(18,"input",20),n(),r(19,"div",21)(20,"div",14)(21,"label",15),d(22,"Hora Inicio"),n(),m(23,"input",22),n(),r(24,"div",14)(25,"label",15),d(26,"Hora Fin"),n(),m(27,"input",23),n()(),r(28,"div",24)(29,"button",25),v("click",function(){h(e);let a=p();return b(a.closeModal())}),d(30,"Cancelar"),n(),r(31,"button",26),g(32,te,2,0,"span",27)(33,ne,3,0,"span",27),n()()()()}if(i&2){let e=p();c(4),l("disabled",e.isSaving),c(2),l("formGroup",e.form),c(7),l("ngForOf",e.services),c(),l("ngIf",e.isAdmin||e.currentUserBranchId),c(17),l("disabled",e.isSaving),c(),l("ngIf",!e.isSaving),c(),l("ngIf",e.isSaving)}}var J=class i{fb=s(U);eventService=s(Y);asistenciaService=s(L);branchService=s(Q);notificationService=s(A);confirmationService=s(H);authService=s(T);calendarComponent;services=[];branches=[];isSaving=!1;showModal=!1;canCreate=!1;canCancel=!1;isAdmin=!1;currentUserBranchId="";form;constructor(){this.form=this.fb.group({serviceId:["",u.required],branchId:[""],date:[new Date().toISOString().substring(0,10),u.required],startTime:["08:00",u.required],endTime:["10:00",u.required]})}ngOnInit(){if(this.checkPermissions(),this.isAdmin&&this.form.get("branchId")?.addValidators(u.required),this.loadServices(),this.isAdmin&&this.loadBranches(),!this.isAdmin){let t=this.authService.currentUser();this.currentUserBranchId=t?.branchId||t?.memberResponseDto?.branch?.id||""}}checkPermissions(){this.canCreate=this.authService.can("REGISTER_EVENTS"),this.canCancel=this.authService.can("CANCEL_EVENTS"),this.isAdmin=this.authService.can("ADMINISTRATOR")}loadServices(){this.asistenciaService.getServices(!0).subscribe(t=>this.services=t)}loadBranches(){this.branchService.findAll().subscribe(t=>this.branches=t)}openModal(t){this.form.reset({serviceId:"",branchId:this.isAdmin?"":this.currentUserBranchId||"",date:t||new Date().toISOString().substring(0,10),startTime:"08:00",endTime:"10:00"}),!this.isAdmin&&this.currentUserBranchId&&this.form.patchValue({branchId:this.currentUserBranchId}),this.showModal=!0}onDaySelected(t){this.canCreate&&this.openModal(t)}closeModal(){this.showModal=!1,this.form.reset(),this.isSaving=!1}save(){if(this.form.invalid||this.isSaving){this.form.markAllAsTouched();return}this.isSaving=!0;let t=this.form.value,e=`${t.date}T${t.startTime}:00`,o=`${t.date}T${t.endTime}:00`,a={serviceId:t.serviceId,branchId:t.branchId,startDateTime:e,endDateTime:o};this.eventService.create(a).subscribe({next:()=>{this.notificationService.success("Evento creado correctamente"),this.calendarComponent&&this.calendarComponent.refresh(),this.closeModal()},error:f=>{console.error("Error saving event",f),this.notificationService.error(f.error?.message||"Error al crear el evento"),this.isSaving=!1}})}cancelEvent(t){return y(this,null,function*(){if(!this.canCancel)return;(yield this.confirmationService.confirm({title:"Cancelar/Finalizar Evento",message:`\xBFEst\xE1s seguro de cancelar o finalizar el evento de ${t.serviceName}?`,type:"danger",confirmText:"S\xED, Cancelar"}))&&this.eventService.cancelEvent(t.id).subscribe({next:()=>{this.notificationService.success("Evento cancelado"),this.calendarComponent&&this.calendarComponent.refresh()},error:o=>{this.notificationService.error("Error al cancelar el evento")}})})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=M({type:i,selectors:[["app-eventos"]],viewQuery:function(e,o){if(e&1&&w(C,5),e&2){let a;O(a=P())&&(o.calendarComponent=a.first)}},decls:4,vars:6,consts:[[3,"eventAction","createEvent","daySelected","isAdmin","isSelectionMode","canCreate"],["class","modal-backdrop",3,"click",4,"ngIf"],["class","modal-loading-overlay",4,"ngIf"],["class","modal-content",4,"ngIf"],[1,"modal-backdrop",3,"click"],[1,"modal-loading-overlay"],[1,"spinner-wrapper"],[1,"spinner-circle"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"btn-icon",3,"click","disabled"],[1,"fa-solid","fa-times"],[1,"modal-form",3,"ngSubmit","formGroup"],[1,"form-group"],[1,"form-label"],["formControlName","serviceId",1,"form-control"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","form-group",4,"ngIf"],["type","date","formControlName","date",1,"form-control"],[1,"form-row"],["type","time","formControlName","startTime",1,"form-control"],["type","time","formControlName","endTime",1,"form-control"],[1,"modal-actions"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],[3,"value"],["formControlName","branchId",1,"form-control"],[1,"fa-solid","fa-spinner","fa-spin"]],template:function(e,o){e&1&&(r(0,"app-service-calendar",0),v("eventAction",function(f){return o.cancelEvent(f)})("createEvent",function(){return o.openModal()})("daySelected",function(f){return o.onDaySelected(f)}),n(),g(1,K,1,0,"div",1)(2,W,5,0,"div",2)(3,ie,34,7,"div",3)),e&2&&(l("isAdmin",o.isAdmin)("isSelectionMode",!1)("canCreate",o.canCreate),c(),l("ngIf",o.showModal),c(),l("ngIf",o.isSaving&&o.showModal),c(),l("ngIf",o.showModal))},dependencies:[I,E,k,q,F,G,R,z,j,N,V,B,D,$,C],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.calendar-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;gap:1rem;padding:1rem;background:var(--bg-main);box-shadow:var(--shadow-sm)}.calendar-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-bottom:.5rem;flex-wrap:wrap;gap:1rem}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1.5rem}.calendar-nav[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;background:var(--bg-card);padding:.25rem;border-radius:12px;border:1px solid var(--border-color);box-shadow:var(--shadow-sm)}.nav-btn[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:none;background:transparent;border-radius:8px;cursor:pointer;color:var(--text-muted);transition:all .2s}.nav-btn[_ngcontent-%COMP%]:hover{background:var(--bg-input);color:var(--primary)}.today-btn[_ngcontent-%COMP%]{width:auto;padding:0 .75rem;font-size:.85rem;font-weight:600}.month-label[_ngcontent-%COMP%]{min-width:150px;text-align:center;font-size:1.1rem;font-weight:700;color:var(--text-main);margin:0;text-transform:capitalize}.header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.soft-input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.soft-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.soft-input-icon[_ngcontent-%COMP%]{position:absolute;left:1rem;color:var(--text-muted);font-size:.9rem;z-index:10}.soft-input[_ngcontent-%COMP%]{width:100%;padding:.6rem 2.5rem;background:var(--bg-input);border:1px solid transparent;border-radius:12px;font-size:.9rem;color:var(--text-main);transition:all .2s ease;cursor:pointer;font-weight:500;min-width:200px}.soft-input[_ngcontent-%COMP%]:hover, .soft-input[_ngcontent-%COMP%]:focus{background:var(--bg-card);border-color:var(--border-color);box-shadow:var(--shadow-sm)}.calendar-wrapper[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:var(--bg-card);border-radius:16px;border:1px solid var(--border-color);box-shadow:var(--shadow-sm);overflow:hidden;min-height:0}.calendar-grid-header[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(7,1fr);border-bottom:1px solid var(--border-color);background:var(--bg-input)}.weekday-cell[_ngcontent-%COMP%]{padding:.75rem;text-align:center;font-size:.85rem;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px}.calendar-grid-body[_ngcontent-%COMP%]{flex:1;display:grid;grid-template-columns:repeat(7,1fr);grid-template-rows:repeat(auto-fill,minmax(100px,1fr));overflow-y:auto}.day-cell[_ngcontent-%COMP%]{border-right:1px solid var(--border-color);border-bottom:1px solid var(--border-color);padding:.5rem;display:flex;flex-direction:column;gap:.5rem;min-height:120px;background:var(--bg-card);transition:background .2s}.day-cell[_ngcontent-%COMP%]:nth-child(7n){border-right:none}.day-cell.not-current-month[_ngcontent-%COMP%]{background:var(--bg-main);opacity:.6}.day-cell.today[_ngcontent-%COMP%]{background:#2563eb0d}.day-cell.today[_ngcontent-%COMP%]   .day-number[_ngcontent-%COMP%]{background:var(--primary);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center}.day-header[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.day-number[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--text-main);padding:2px}.day-events[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem;overflow-y:auto}.event-pill[_ngcontent-%COMP%]{background:#6366f11a;border-left:3px solid #6366f1;padding:.25rem .5rem;border-radius:4px;font-size:.75rem;color:var(--text-main);cursor:pointer;transition:all .2s;display:flex;flex-direction:column;line-height:1.2}.event-pill[_ngcontent-%COMP%]:hover{background:#6366f133;transform:translateY(-1px)}.event-time[_ngcontent-%COMP%]{font-weight:700;font-size:.7rem;color:#6366f1}.event-title[_ngcontent-%COMP%]{font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.event-branch[_ngcontent-%COMP%]{font-size:.65rem;color:var(--text-muted)}.loading-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#fffc;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid var(--primary);border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;z-index:1000;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal-content[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--bg-card);width:90%;max-width:500px;border-radius:16px;padding:1.5rem;z-index:1001;box-shadow:var(--shadow-lg);border:1px solid var(--border-color)}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.modal-title[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:700}.btn-icon[_ngcontent-%COMP%]{background:transparent;border:none;font-size:1.2rem;color:var(--text-muted);cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-size:.9rem;font-weight:600;color:var(--text-muted)}.form-control[_ngcontent-%COMP%]{width:100%;padding:.75rem;border-radius:8px;border:1px solid var(--border-color);background:var(--bg-input);color:var(--text-main);font-size:.95rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1rem}.modal-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem;margin-top:1.5rem}@media(max-width:768px){.calendar-container[_ngcontent-%COMP%]{padding:.5rem}.calendar-header[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:.5rem}.header-left[_ngcontent-%COMP%], .header-actions[_ngcontent-%COMP%]{justify-content:space-between;width:100%}.month-label[_ngcontent-%COMP%]{min-width:auto;font-size:1rem;flex:1}.calendar-wrapper[_ngcontent-%COMP%]{border-radius:12px}.weekday-cell[_ngcontent-%COMP%]{padding:.5rem .25rem;font-size:.7rem}.day-cell[_ngcontent-%COMP%]{min-height:80px;padding:.25rem}.day-number[_ngcontent-%COMP%]{font-size:.8rem}.event-pill[_ngcontent-%COMP%]{padding:.15rem .25rem;border-left-width:2px}.event-time[_ngcontent-%COMP%], .event-title[_ngcontent-%COMP%]{font-size:.65rem}.desktop-only[_ngcontent-%COMP%]{display:none}.branch-filter-group[_ngcontent-%COMP%]{min-width:auto!important;flex:0 0 auto!important;width:42px!important;position:relative}.branch-filter-group[_ngcontent-%COMP%]   .soft-input-wrapper[_ngcontent-%COMP%]{justify-content:center}.branch-filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:0!important;color:transparent!important;background-color:var(--bg-input)!important;background-image:none!important;text-align:center;width:100%!important;direction:rtl}.branch-filter-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:var(--text-main)!important;background-color:var(--bg-card)!important;direction:ltr;text-align:left}.branch-filter-group[_ngcontent-%COMP%]   .soft-input-icon[_ngcontent-%COMP%]{left:50%!important;transform:translate(-50%,-50%)!important}}"]})};export{J as Eventos};
